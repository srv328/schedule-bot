from aiogram import Router, F
from aiogram.types import Message, CallbackQuery, FSInputFile
from utils import bot
from aiogram.enums.parse_mode import ParseMode
from keyboards import clear_button, schedule_markup
from work_with_db import has_schedule, execute_query


router = Router()


@router.message(F.text == "–û—á–∏—Å—Ç–∏—Ç—åüóë")
async def clear_schedule(message: Message):
    if has_schedule(message.from_user.id):
        await message.answer(text="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ?\n"
                                  "<b>–í–Ω–∏–º–∞–Ω–∏–µ</b>‚ùóÔ∏è\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ <b>–Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å</b>‚ö†", reply_markup=clear_button,
                             parse_mode=ParseMode.HTML)
    else:
        await message.answer(text="<b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—É—Å—Ç–æ–µ, –Ω–µ—á–µ–≥–æ –æ—á–∏—â–∞—Ç—å!</b>",
                             parse_mode=ParseMode.HTML,
                             reply_markup=schedule_markup)
        gif = FSInputFile("media/–ª–æ—Å—è—à.mp4")
        await message.answer_video(gif)


@router.callback_query(lambda query: query.data == 'yes_clear')
async def clear_yes(query: CallbackQuery):
    delete_query = "DELETE FROM schedule WHERE user_id = ?"
    execute_query(delete_query, query.from_user.id)
    await bot.delete_message(chat_id=query.from_user.id, message_id=query.message.message_id)
    await query.message.answer(text="<b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω–æ!</b>",
                               parse_mode=ParseMode.HTML,
                               reply_markup=schedule_markup)


@router.callback_query(lambda query: query.data == 'no_clear')
async def clear_no(query: CallbackQuery):
    await bot.delete_message(chat_id=query.from_user.id, message_id=query.message.message_id)
    await query.message.answer(text="<b>–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ</b>‚ôª",
                               parse_mode=ParseMode.HTML,
                               reply_markup=schedule_markup)
